import{c as y,g as qr,a as lt,A as ft,r as j,t as M,j as Lr,T as Ur}from"./index-BesDIcg5.js";function Hr(s,e){s.terminate=function(){const t=()=>{};this.onerror=t,this.onmessage=t,this.onopen=t;const r=new Date,n=Math.random().toString().substring(2,8),i=this.onclose;this.onclose=o=>{const a=new Date().getTime()-r.getTime();e(`Discarded socket (#${n})  closed after ${a}ms, with code/reason: ${o.code}/${o.reason}`)},this.close(),i?.call(s,{code:4001,reason:`Quick discarding socket (#${n}) without waiting for the shutdown sequence.`,wasClean:!1})}}const G={LF:`
`,NULL:"\0"};class D{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(e){const{command:t,headers:r,body:n,binaryBody:i,escapeHeaderValues:o,skipContentLengthHeader:a}=e;this.command=t,this.headers=Object.assign({},r||{}),i?(this._binaryBody=i,this.isBinaryBody=!0):(this._body=n||"",this.isBinaryBody=!1),this.escapeHeaderValues=o||!1,this.skipContentLengthHeader=a||!1}static fromRawFrame(e,t){const r={},n=i=>i.replace(/^\s+|\s+$/g,"");for(const i of e.headers.reverse()){i.indexOf(":");const o=n(i[0]);let a=n(i[1]);t&&e.command!=="CONNECT"&&e.command!=="CONNECTED"&&(a=D.hdrValueUnEscape(a)),r[o]=a}return new D({command:e.command,headers:r,binaryBody:e.binaryBody,escapeHeaderValues:t})}toString(){return this.serializeCmdAndHeaders()}serialize(){const e=this.serializeCmdAndHeaders();return this.isBinaryBody?D.toUnit8Array(e,this._binaryBody).buffer:e+this._body+G.NULL}serializeCmdAndHeaders(){const e=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const t of Object.keys(this.headers||{})){const r=this.headers[t];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?e.push(`${t}:${D.hdrValueEscape(`${r}`)}`):e.push(`${t}:${r}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&e.push(`content-length:${this.bodyLength()}`),e.join(G.LF)+G.LF+G.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const e=this.binaryBody;return e?e.length:0}static sizeOfUTF8(e){return e?new TextEncoder().encode(e).length:0}static toUnit8Array(e,t){const r=new TextEncoder().encode(e),n=new Uint8Array([0]),i=new Uint8Array(r.length+t.length+n.length);return i.set(r),i.set(t,r.length),i.set(n,r.length+t.length),i}static marshall(e){return new D(e).serialize()}static hdrValueEscape(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const dt=0,Y=10,ee=13,Br=58;class jr{constructor(e,t){this.onFrame=e,this.onIncomingPing=t,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(e,t=!1){let r;if(typeof e=="string"?r=this._encoder.encode(e):r=new Uint8Array(e),t&&r[r.length-1]!==0){const n=new Uint8Array(r.length+1);n.set(r,0),n[r.length]=0,r=n}for(let n=0;n<r.length;n++){const i=r[n];this._onByte(i)}}_collectFrame(e){if(e!==dt&&e!==ee){if(e===Y){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(e)}}_collectCommand(e){if(e!==ee){if(e===Y){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_collectHeaders(e){if(e!==ee){if(e===Y){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(e)}}_reinjectByte(e){this._onByte(e)}_collectHeaderKey(e){if(e===Br){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(e)}_collectHeaderValue(e){if(e!==ee){if(e===Y){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_setupCollectBody(){const e=this._results.headers.filter(t=>t[0]==="content-length")[0];e?(this._bodyBytesRemaining=parseInt(e[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(e){if(e===dt){this._retrievedBody();return}this._consumeByte(e)}_collectBodyFixedSize(e){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(e)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(e){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",e)}this._initState()}_consumeByte(e){this._token.push(e)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const e=new Uint8Array(this._token);return this._token=[],e}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var P;(function(s){s[s.CONNECTING=0]="CONNECTING",s[s.OPEN=1]="OPEN",s[s.CLOSING=2]="CLOSING",s[s.CLOSED=3]="CLOSED"})(P||(P={}));var H;(function(s){s[s.ACTIVE=0]="ACTIVE",s[s.DEACTIVATING=1]="DEACTIVATING",s[s.INACTIVE=2]="INACTIVE"})(H||(H={}));var se;(function(s){s[s.LINEAR=0]="LINEAR",s[s.EXPONENTIAL=1]="EXPONENTIAL"})(se||(se={}));var J;(function(s){s.Interval="interval",s.Worker="worker"})(J||(J={}));class Dr{constructor(e,t=J.Interval,r){this._interval=e,this._strategy=t,this._debug=r,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(e){this.stop(),this.shouldUseWorker()?this.runWorker(e):this.runInterval(e)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===J.Worker}runWorker(e){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=t=>e(t.data))}runInterval(e){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const t=Date.now();this._timer=setInterval(()=>{e(Date.now()-t)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class q{constructor(e){this.versions=e}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(e=>`v${e.replace(".","")}.stomp`)}}q.V1_0="1.0";q.V1_1="1.1";q.V1_2="1.2";q.default=new q([q.V1_2,q.V1_1,q.V1_0]);class Pr{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(e,t,r){this._client=e,this._webSocket=t,this._connected=!1,this._serverFrameHandlers={CONNECTED:n=>{this.debug(`connected to server ${n.headers.server}`),this._connected=!0,this._connectedVersion=n.headers.version,this._connectedVersion===q.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(n.headers),this.onConnect(n)},MESSAGE:n=>{const i=n.headers.subscription,o=this._subscriptions[i]||this.onUnhandledMessage,a=n,c=this,l=this._connectedVersion===q.V1_2?a.headers.ack:a.headers["message-id"];a.ack=(u={})=>c.ack(l,i,u),a.nack=(u={})=>c.nack(l,i,u),o(a)},RECEIPT:n=>{const i=this._receiptWatchers[n.headers["receipt-id"]];i?(i(n),delete this._receiptWatchers[n.headers["receipt-id"]]):this.onUnhandledReceipt(n)},ERROR:n=>{this.onStompError(n)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=r.debug,this.stompVersions=r.stompVersions,this.connectHeaders=r.connectHeaders,this.disconnectHeaders=r.disconnectHeaders,this.heartbeatIncoming=r.heartbeatIncoming,this.heartbeatToleranceMultiplier=r.heartbeatGracePeriods,this.heartbeatOutgoing=r.heartbeatOutgoing,this.splitLargeFrames=r.splitLargeFrames,this.maxWebSocketChunkSize=r.maxWebSocketChunkSize,this.forceBinaryWSFrames=r.forceBinaryWSFrames,this.logRawCommunication=r.logRawCommunication,this.appendMissingNULLonIncoming=r.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=r.discardWebsocketOnCommFailure,this.onConnect=r.onConnect,this.onDisconnect=r.onDisconnect,this.onStompError=r.onStompError,this.onWebSocketClose=r.onWebSocketClose,this.onWebSocketError=r.onWebSocketError,this.onUnhandledMessage=r.onUnhandledMessage,this.onUnhandledReceipt=r.onUnhandledReceipt,this.onUnhandledFrame=r.onUnhandledFrame,this.onHeartbeatReceived=r.onHeartbeatReceived,this.onHeartbeatLost=r.onHeartbeatLost}start(){const e=new jr(t=>{const r=D.fromRawFrame(t,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${r}`),(this._serverFrameHandlers[r.command]||this.onUnhandledFrame)(r)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=t=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const r=t.data instanceof ArrayBuffer?new TextDecoder().decode(t.data):t.data;this.debug(`<<< ${r}`)}e.parseChunk(t.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=t=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(t)},this._webSocket.onerror=t=>{this.onWebSocketError(t)},this._webSocket.onopen=()=>{const t=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),t["accept-version"]=this.stompVersions.supportedVersions(),t["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:t})}}_setupHeartbeat(e){if(e.version!==q.V1_1&&e.version!==q.V1_2||!e["heart-beat"])return;const[t,r]=e["heart-beat"].split(",").map(n=>parseInt(n,10));if(this.heartbeatOutgoing!==0&&r!==0){const n=Math.max(this.heartbeatOutgoing,r);this.debug(`send PING every ${n}ms`),this._pinger=new Dr(n,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===P.OPEN&&(this._webSocket.send(G.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&t!==0){const n=Math.max(this.heartbeatIncoming,t);this.debug(`check PONG every ${n}ms`),this._ponger=setInterval(()=>{const i=Date.now()-this._lastServerActivityTS;i>n*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${i}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},n)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===P.CONNECTING||this._webSocket.readyState===P.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&Hr(this._webSocket,e=>this.debug(e)),this._webSocket.terminate()}_transmit(e){const{command:t,headers:r,body:n,binaryBody:i,skipContentLengthHeader:o}=e,a=new D({command:t,headers:r,body:n,binaryBody:i,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:o});let c=a.serialize();if(this.logRawCommunication?this.debug(`>>> ${c}`):this.debug(`>>> ${a}`),this.forceBinaryWSFrames&&typeof c=="string"&&(c=new TextEncoder().encode(c)),typeof c!="string"||!this.splitLargeFrames)this._webSocket.send(c);else{let l=c;for(;l.length>0;){const u=l.substring(0,this.maxWebSocketChunkSize);l=l.substring(this.maxWebSocketChunkSize),this._webSocket.send(u),this.debug(`chunk sent = ${u.length}, remaining = ${l.length}`)}}}dispose(){if(this.connected)try{const e=Object.assign({},this.disconnectHeaders);e.receipt||(e.receipt=`close-${this._counter++}`),this.watchForReceipt(e.receipt,t=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:e})}catch(e){this.debug(`Ignoring error during disconnect ${e}`)}else(this._webSocket.readyState===P.CONNECTING||this._webSocket.readyState===P.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(e){const{destination:t,headers:r,body:n,binaryBody:i,skipContentLengthHeader:o}=e,a=Object.assign({destination:t},r);this._transmit({command:"SEND",headers:a,body:n,binaryBody:i,skipContentLengthHeader:o})}watchForReceipt(e,t){this._receiptWatchers[e]=t}subscribe(e,t,r={}){r=Object.assign({},r),r.id||(r.id=`sub-${this._counter++}`),r.destination=e,this._subscriptions[r.id]=t,this._transmit({command:"SUBSCRIBE",headers:r});const n=this;return{id:r.id,unsubscribe(i){return n.unsubscribe(r.id,i)}}}unsubscribe(e,t={}){t=Object.assign({},t),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})}begin(e){const t=e||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:t}});const r=this;return{id:t,commit(){r.commit(t)},abort(){r.abort(t)}}}commit(e){this._transmit({command:"COMMIT",headers:{transaction:e}})}abort(e){this._transmit({command:"ABORT",headers:{transaction:e}})}ack(e,t,r={}){r=Object.assign({},r),this._connectedVersion===q.V1_2?r.id=e:r["message-id"]=e,r.subscription=t,this._transmit({command:"ACK",headers:r})}nack(e,t,r={}){return r=Object.assign({},r),this._connectedVersion===q.V1_2?r.id=e:r["message-id"]=e,r.subscription=t,this._transmit({command:"NACK",headers:r})}}class Wr{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(e){this._disconnectHeaders=e,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===H.ACTIVE}_changeState(e){this.state=e,this.onChangeState(e)}constructor(e={}){this.stompVersions=q.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=se.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=J.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=H.INACTIVE;const t=()=>{};this.debug=t,this.beforeConnect=t,this.onConnect=t,this.onDisconnect=t,this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onHeartbeatReceived=t,this.onHeartbeatLost=t,this.onStompError=t,this.onWebSocketClose=t,this.onWebSocketError=t,this.logRawCommunication=!1,this.onChangeState=t,this.connectHeaders={},this._disconnectHeaders={},this.configure(e)}configure(e){Object.assign(this,e),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const e=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(H.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===H.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{e()})):e()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const e=this._createWebSocket();this._stompHandler=new Pr(this,e,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatGracePeriods:this.heartbeatToleranceMultiplier,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:t=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),this._nextReconnectDelay=this.reconnectDelay,!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(t)},onDisconnect:t=>{this.onDisconnect(t)},onStompError:t=>{this.onStompError(t)},onWebSocketClose:t=>{this._stompHandler=void 0,this.state===H.DEACTIVATING&&this._changeState(H.INACTIVE),this.onWebSocketClose(t),this.active&&this._schedule_reconnect()},onWebSocketError:t=>{this.onWebSocketError(t)},onUnhandledMessage:t=>{this.onUnhandledMessage(t)},onUnhandledReceipt:t=>{this.onUnhandledReceipt(t)},onUnhandledFrame:t=>{this.onUnhandledFrame(t)},onHeartbeatReceived:()=>{this.onHeartbeatReceived()},onHeartbeatLost:()=>{this.onHeartbeatLost()}}),this._stompHandler.start()}_createWebSocket(){let e;if(this.webSocketFactory)e=this.webSocketFactory();else if(this.brokerURL)e=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return e.binaryType="arraybuffer",e}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===se.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(e={}){const t=e.force||!1,r=this.active;let n;if(this.state===H.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(H.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==P.CLOSED){const i=this._stompHandler.onWebSocketClose;n=new Promise((o,a)=>{this._stompHandler.onWebSocketClose=c=>{i(c),o()}})}else return this._changeState(H.INACTIVE),Promise.resolve();return t?this._stompHandler?.discardWebsocket():r&&this._disposeStompHandler(),n}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(e){this._checkConnection(),this._stompHandler.publish(e)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(e,t){this._checkConnection(),this._stompHandler.watchForReceipt(e,t)}subscribe(e,t,r={}){return this._checkConnection(),this._stompHandler.subscribe(e,t,r)}unsubscribe(e,t={}){this._checkConnection(),this._stompHandler.unsubscribe(e,t)}begin(e){return this._checkConnection(),this._stompHandler.begin(e)}commit(e){this._checkConnection(),this._stompHandler.commit(e)}abort(e){this._checkConnection(),this._stompHandler.abort(e)}ack(e,t,r={}){this._checkConnection(),this._stompHandler.ack(e,t,r)}nack(e,t,r={}){this._checkConnection(),this._stompHandler.nack(e,t,r)}}var ce={exports:{}},te={},pt;function Fr(){return pt||(pt=1,y.crypto&&y.crypto.getRandomValues?te.randomBytes=function(s){var e=new Uint8Array(s);return y.crypto.getRandomValues(e),e}:te.randomBytes=function(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=Math.floor(Math.random()*256);return e}),te}var ue,mt;function V(){if(mt)return ue;mt=1;var s=Fr(),e="abcdefghijklmnopqrstuvwxyz012345";return ue={string:function(t){for(var r=e.length,n=s.randomBytes(t),i=[],o=0;o<t;o++)i.push(e.substr(n[o]%r,1));return i.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var r=(""+(t-1)).length,n=new Array(r+1).join("0");return(n+this.number(t)).slice(-r)}},ue}var vt;function W(){return vt||(vt=1,(function(s){var e=V(),t={},r=!1,n=y.chrome&&y.chrome.app&&y.chrome.app.runtime;s.exports={attachEvent:function(o,a){typeof y.addEventListener<"u"?y.addEventListener(o,a,!1):y.document&&y.attachEvent&&(y.document.attachEvent("on"+o,a),y.attachEvent("on"+o,a))},detachEvent:function(o,a){typeof y.addEventListener<"u"?y.removeEventListener(o,a,!1):y.document&&y.detachEvent&&(y.document.detachEvent("on"+o,a),y.detachEvent("on"+o,a))},unloadAdd:function(o){if(n)return null;var a=e.string(8);return t[a]=o,r&&setTimeout(this.triggerUnloadCallbacks,0),a},unloadDel:function(o){o in t&&delete t[o]},triggerUnloadCallbacks:function(){for(var o in t)t[o](),delete t[o]}};var i=function(){r||(r=!0,s.exports.triggerUnloadCallbacks())};n||s.exports.attachEvent("unload",i)})(ce)),ce.exports}var he,bt;function Mr(){return bt||(bt=1,he=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}),he}var re={},gt;function Vr(){if(gt)return re;gt=1;var s=Object.prototype.hasOwnProperty,e;function t(o){try{return decodeURIComponent(o.replace(/\+/g," "))}catch{return null}}function r(o){try{return encodeURIComponent(o)}catch{return null}}function n(o){for(var a=/([^=?#&]+)=?([^&]*)/g,c={},l;l=a.exec(o);){var u=t(l[1]),d=t(l[2]);u===null||d===null||u in c||(c[u]=d)}return c}function i(o,a){a=a||"";var c=[],l,u;typeof a!="string"&&(a="?");for(u in o)if(s.call(o,u)){if(l=o[u],!l&&(l===null||l===e||isNaN(l))&&(l=""),u=r(u),l=r(l),u===null||l===null)continue;c.push(u+"="+l)}return c.length?a+c.join("&"):""}return re.stringify=i,re.parse=n,re}var le,yt;function Er(){if(yt)return le;yt=1;var s=Mr(),e=Vr(),t=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r=/[\n\r\t]/g,n=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,i=/:\d+$/,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,a=/^[a-zA-Z]:/;function c(p){return(p||"").toString().replace(t,"")}var l=[["#","hash"],["?","query"],function(m,h){return b(h.protocol)?m.replace(/\\/g,"/"):m},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],u={hash:1,query:1};function d(p){var m;typeof window<"u"?m=window:typeof y<"u"?m=y:typeof self<"u"?m=self:m={};var h=m.location||{};p=p||h;var v={},E=typeof p,g;if(p.protocol==="blob:")v=new k(unescape(p.pathname),{});else if(E==="string"){v=new k(p,{});for(g in u)delete v[g]}else if(E==="object"){for(g in p)g in u||(v[g]=p[g]);v.slashes===void 0&&(v.slashes=n.test(p.href))}return v}function b(p){return p==="file:"||p==="ftp:"||p==="http:"||p==="https:"||p==="ws:"||p==="wss:"}function S(p,m){p=c(p),p=p.replace(r,""),m=m||{};var h=o.exec(p),v=h[1]?h[1].toLowerCase():"",E=!!h[2],g=!!h[3],f=0,_;return E?g?(_=h[2]+h[3]+h[4],f=h[2].length+h[3].length):(_=h[2]+h[4],f=h[2].length):g?(_=h[3]+h[4],f=h[3].length):_=h[4],v==="file:"?f>=2&&(_=_.slice(2)):b(v)?_=h[4]:v?E&&(_=_.slice(2)):f>=2&&b(m.protocol)&&(_=h[4]),{protocol:v,slashes:E||b(v),slashesCount:f,rest:_}}function R(p,m){if(p==="")return m;for(var h=(m||"/").split("/").slice(0,-1).concat(p.split("/")),v=h.length,E=h[v-1],g=!1,f=0;v--;)h[v]==="."?h.splice(v,1):h[v]===".."?(h.splice(v,1),f++):f&&(v===0&&(g=!0),h.splice(v,1),f--);return g&&h.unshift(""),(E==="."||E==="..")&&h.push(""),h.join("/")}function k(p,m,h){if(p=c(p),p=p.replace(r,""),!(this instanceof k))return new k(p,m,h);var v,E,g,f,_,T,x=l.slice(),N=typeof m,w=this,B=0;for(N!=="object"&&N!=="string"&&(h=m,m=null),h&&typeof h!="function"&&(h=e.parse),m=d(m),E=S(p||"",m),v=!E.protocol&&!E.slashes,w.slashes=E.slashes||v&&m.slashes,w.protocol=E.protocol||m.protocol||"",p=E.rest,(E.protocol==="file:"&&(E.slashesCount!==2||a.test(p))||!E.slashes&&(E.protocol||E.slashesCount<2||!b(w.protocol)))&&(x[3]=[/(.*)/,"pathname"]);B<x.length;B++){if(f=x[B],typeof f=="function"){p=f(p,w);continue}g=f[0],T=f[1],g!==g?w[T]=p:typeof g=="string"?(_=g==="@"?p.lastIndexOf(g):p.indexOf(g),~_&&(typeof f[2]=="number"?(w[T]=p.slice(0,_),p=p.slice(_+f[2])):(w[T]=p.slice(_),p=p.slice(0,_)))):(_=g.exec(p))&&(w[T]=_[1],p=p.slice(0,_.index)),w[T]=w[T]||v&&f[3]&&m[T]||"",f[4]&&(w[T]=w[T].toLowerCase())}h&&(w.query=h(w.query)),v&&m.slashes&&w.pathname.charAt(0)!=="/"&&(w.pathname!==""||m.pathname!=="")&&(w.pathname=R(w.pathname,m.pathname)),w.pathname.charAt(0)!=="/"&&b(w.protocol)&&(w.pathname="/"+w.pathname),s(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(_=w.auth.indexOf(":"),~_?(w.username=w.auth.slice(0,_),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(_+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin=w.protocol!=="file:"&&b(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}function I(p,m,h){var v=this;switch(p){case"query":typeof m=="string"&&m.length&&(m=(h||e.parse)(m)),v[p]=m;break;case"port":v[p]=m,s(m,v.protocol)?m&&(v.host=v.hostname+":"+m):(v.host=v.hostname,v[p]="");break;case"hostname":v[p]=m,v.port&&(m+=":"+v.port),v.host=m;break;case"host":v[p]=m,i.test(m)?(m=m.split(":"),v.port=m.pop(),v.hostname=m.join(":")):(v.hostname=m,v.port="");break;case"protocol":v.protocol=m.toLowerCase(),v.slashes=!h;break;case"pathname":case"hash":if(m){var E=p==="pathname"?"/":"#";v[p]=m.charAt(0)!==E?E+m:m}else v[p]=m;break;case"username":case"password":v[p]=encodeURIComponent(m);break;case"auth":var g=m.indexOf(":");~g?(v.username=m.slice(0,g),v.username=encodeURIComponent(decodeURIComponent(v.username)),v.password=m.slice(g+1),v.password=encodeURIComponent(decodeURIComponent(v.password))):v.username=encodeURIComponent(decodeURIComponent(m))}for(var f=0;f<l.length;f++){var _=l[f];_[4]&&(v[_[1]]=v[_[1]].toLowerCase())}return v.auth=v.password?v.username+":"+v.password:v.username,v.origin=v.protocol!=="file:"&&b(v.protocol)&&v.host?v.protocol+"//"+v.host:"null",v.href=v.toString(),v}function O(p){(!p||typeof p!="function")&&(p=e.stringify);var m,h=this,v=h.host,E=h.protocol;E&&E.charAt(E.length-1)!==":"&&(E+=":");var g=E+(h.protocol&&h.slashes||b(h.protocol)?"//":"");return h.username?(g+=h.username,h.password&&(g+=":"+h.password),g+="@"):h.password?(g+=":"+h.password,g+="@"):h.protocol!=="file:"&&b(h.protocol)&&!v&&h.pathname!=="/"&&(g+="@"),(v[v.length-1]===":"||i.test(h.hostname)&&!h.port)&&(v+=":"),g+=v+h.pathname,m=typeof h.query=="object"?p(h.query):h.query,m&&(g+=m.charAt(0)!=="?"?"?"+m:m),h.hash&&(g+=h.hash),g}return k.prototype={set:I,toString:O},k.extractProtocol=S,k.location=d,k.trimLeft=c,k.qs=e,le=k,le}var fe,_t;function U(){if(_t)return fe;_t=1;var s=Er();return fe={getOrigin:function(e){if(!e)return null;var t=new s(e);if(t.protocol==="file:")return null;var r=t.port;return r||(r=t.protocol==="https:"?"443":"80"),t.protocol+"//"+t.hostname+":"+r},isOriginEqual:function(e,t){var r=this.getOrigin(e)===this.getOrigin(t);return r},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var r=e.split("?");return r[0]+t+(r[1]?"?"+r[1]:"")},addQuery:function(e,t){return e+(e.indexOf("?")===-1?"?"+t:"&"+t)},isLoopbackAddr:function(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^\[::1\]$/.test(e)}},fe}var ne={exports:{}},wt;function C(){return wt||(wt=1,typeof Object.create=="function"?ne.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:ne.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}),ne.exports}var de={},pe,Et;function Sr(){if(Et)return pe;Et=1;function s(){this._listeners={}}return s.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];r.indexOf(t)===-1&&(r=r.concat([t])),this._listeners[e]=r},s.prototype.removeEventListener=function(e,t){var r=this._listeners[e];if(r){var n=r.indexOf(t);if(n!==-1){r.length>1?this._listeners[e]=r.slice(0,n).concat(r.slice(n+1)):delete this._listeners[e];return}}},s.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,r=arguments.length===1?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,r),t in this._listeners)for(var n=this._listeners[t],i=0;i<n.length;i++)n[i].apply(this,r)},pe=s,pe}var St;function L(){if(St)return de;St=1;var s=C(),e=Sr();function t(){e.call(this)}return s(t,e),t.prototype.removeAllListeners=function(r){r?delete this._listeners[r]:this._listeners={}},t.prototype.once=function(r,n){var i=this,o=!1;function a(){i.removeListener(r,a),o||(o=!0,n.apply(this,arguments))}this.on(r,a)},t.prototype.emit=function(){var r=arguments[0],n=this._listeners[r];if(n){for(var i=arguments.length,o=new Array(i-1),a=1;a<i;a++)o[a-1]=arguments[a];for(var c=0;c<n.length;c++)n[c].apply(this,o)}},t.prototype.on=t.prototype.addListener=e.prototype.addEventListener,t.prototype.removeListener=e.prototype.removeEventListener,de.EventEmitter=t,de}var ie={exports:{}},kt;function $r(){if(kt)return ie.exports;kt=1;var s=y.WebSocket||y.MozWebSocket;return s?ie.exports=function(t){return new s(t)}:ie.exports=void 0,ie.exports}var me,Tt;function Xr(){if(Tt)return me;Tt=1;var s=W(),e=U(),t=C(),r=L().EventEmitter,n=$r(),i=function(){};function o(a,c,l){if(!o.enabled())throw new Error("Transport created when disabled");r.call(this);var u=this,d=e.addPath(a,"/websocket");d.slice(0,5)==="https"?d="wss"+d.slice(5):d="ws"+d.slice(4),this.url=d,this.ws=new n(this.url,[],l),this.ws.onmessage=function(b){i("message event",b.data),u.emit("message",b.data)},this.unloadRef=s.unloadAdd(function(){u.ws.close()}),this.ws.onclose=function(b){i("close event",b.code,b.reason),u.emit("close",b.code,b.reason),u._cleanup()},this.ws.onerror=function(b){u.emit("close",1006,"WebSocket connection broken"),u._cleanup()}}return t(o,r),o.prototype.send=function(a){var c="["+a+"]";this.ws.send(c)},o.prototype.close=function(){var a=this.ws;this._cleanup(),a&&a.close()},o.prototype._cleanup=function(){var a=this.ws;a&&(a.onmessage=a.onclose=a.onerror=null),s.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},o.enabled=function(){return!!n},o.transportName="websocket",o.roundTrips=2,me=o,me}var ve,xt;function Gr(){if(xt)return ve;xt=1;var s=C(),e=L().EventEmitter,t=function(){};function r(n,i){e.call(this),this.sendBuffer=[],this.sender=i,this.url=n}return s(r,e),r.prototype.send=function(n){this.sendBuffer.push(n),this.sendStop||this.sendSchedule()},r.prototype.sendScheduleWait=function(){var n=this,i;this.sendStop=function(){n.sendStop=null,clearTimeout(i)},i=setTimeout(function(){n.sendStop=null,n.sendSchedule()},25)},r.prototype.sendSchedule=function(){t("sendSchedule",this.sendBuffer.length);var n=this;if(this.sendBuffer.length>0){var i="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,i,function(o){n.sendStop=null,o?(n.emit("close",o.code||1006,"Sending error: "+o),n.close()):n.sendScheduleWait()}),this.sendBuffer=[]}},r.prototype._cleanup=function(){this.removeAllListeners()},r.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},ve=r,ve}var be,Ct;function Jr(){if(Ct)return be;Ct=1;var s=C(),e=L().EventEmitter,t=function(){};function r(n,i,o){e.call(this),this.Receiver=n,this.receiveUrl=i,this.AjaxObject=o,this._scheduleReceiver()}return s(r,e),r.prototype._scheduleReceiver=function(){var n=this,i=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);i.on("message",function(o){n.emit("message",o)}),i.once("close",function(o,a){t("close",o,a,n.pollIsClosing),n.poll=i=null,n.pollIsClosing||(a==="network"?n._scheduleReceiver():(n.emit("close",o||1006,a),n.removeAllListeners()))})},r.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},be=r,be}var ge,Rt;function kr(){if(Rt)return ge;Rt=1;var s=C(),e=U(),t=Gr(),r=Jr();function n(i,o,a,c,l){var u=e.addPath(i,o),d=this;t.call(this,i,a),this.poll=new r(c,u,l),this.poll.on("message",function(b){d.emit("message",b)}),this.poll.once("close",function(b,S){d.poll=null,d.emit("close",b,S),d.close()})}return s(n,t),n.prototype.close=function(){t.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},ge=n,ge}var ye,It;function $(){if(It)return ye;It=1;var s=C(),e=U(),t=kr();function r(i){return function(o,a,c){var l={};typeof a=="string"&&(l.headers={"Content-type":"text/plain"});var u=e.addPath(o,"/xhr_send"),d=new i("POST",u,a,l);return d.once("finish",function(b){if(d=null,b!==200&&b!==204)return c(new Error("http status "+b));c()}),function(){d.close(),d=null;var b=new Error("Aborted");b.code=1e3,c(b)}}}function n(i,o,a,c){t.call(this,i,o,r(c),a,c)}return s(n,t),ye=n,ye}var _e,Ot;function oe(){if(Ot)return _e;Ot=1;var s=C(),e=L().EventEmitter;function t(r,n){e.call(this);var i=this;this.bufferPosition=0,this.xo=new n("POST",r,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(o,a){i._chunkHandler(o,a),i.xo=null;var c=o===200?"network":"permanent";i.emit("close",null,c),i._cleanup()})}return s(t,e),t.prototype._chunkHandler=function(r,n){if(!(r!==200||!n))for(var i=-1;;this.bufferPosition+=i+1){var o=n.slice(this.bufferPosition);if(i=o.indexOf(`
`),i===-1)break;var a=o.slice(0,i);a&&this.emit("message",a)}},t.prototype._cleanup=function(){this.removeAllListeners()},t.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},_e=t,_e}var we,Nt;function Tr(){if(Nt)return we;Nt=1;var s=L().EventEmitter,e=C(),t=W(),r=U(),n=y.XMLHttpRequest,i=function(){};function o(l,u,d,b){var S=this;s.call(this),setTimeout(function(){S._start(l,u,d,b)},0)}e(o,s),o.prototype._start=function(l,u,d,b){var S=this;try{this.xhr=new n}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}u=r.addQuery(u,"t="+ +new Date),this.unloadRef=t.unloadAdd(function(){S._cleanup(!0)});try{this.xhr.open(l,u,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){i("xhr timeout"),S.emit("finish",0,""),S._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!b||!b.noCredentials)&&o.supportsCORS&&(this.xhr.withCredentials=!0),b&&b.headers)for(var R in b.headers)this.xhr.setRequestHeader(R,b.headers[R]);this.xhr.onreadystatechange=function(){if(S.xhr){var k=S.xhr,I,O;switch(i("readyState",k.readyState),k.readyState){case 3:try{O=k.status,I=k.responseText}catch{}O===1223&&(O=204),O===200&&I&&I.length>0&&S.emit("chunk",O,I);break;case 4:O=k.status,O===1223&&(O=204),(O===12005||O===12029)&&(O=0),i("finish",O,k.responseText),S.emit("finish",O,k.responseText),S._cleanup(!1);break}}};try{S.xhr.send(d)}catch{S.emit("finish",0,""),S._cleanup(!1)}},o.prototype._cleanup=function(l){if(this.xhr){if(this.removeAllListeners(),t.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),l)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},o.prototype.close=function(){this._cleanup(!0)},o.enabled=!!n;var a=["Active"].concat("Object").join("X");!o.enabled&&a in y&&(n=function(){try{return new y[a]("Microsoft.XMLHTTP")}catch{return null}},o.enabled=!!new n);var c=!1;try{c="withCredentials"in new n}catch{}return o.supportsCORS=c,we=o,we}var Ee,At;function ae(){if(At)return Ee;At=1;var s=C(),e=Tr();function t(r,n,i,o){e.call(this,r,n,i,o)}return s(t,e),t.enabled=e.enabled&&e.supportsCORS,Ee=t,Ee}var Se,qt;function z(){if(qt)return Se;qt=1;var s=C(),e=Tr();function t(r,n,i){e.call(this,r,n,i,{noCredentials:!0})}return s(t,e),t.enabled=e.enabled,Se=t,Se}var ke,Lt;function Q(){return Lt||(Lt=1,ke={isOpera:function(){return y.navigator&&/opera/i.test(y.navigator.userAgent)},isKonqueror:function(){return y.navigator&&/konqueror/i.test(y.navigator.userAgent)},hasDomain:function(){if(!y.document)return!0;try{return!!y.document.domain}catch{return!1}}}),ke}var Te,Ut;function zr(){if(Ut)return Te;Ut=1;var s=C(),e=$(),t=oe(),r=ae(),n=z(),i=Q();function o(a){if(!n.enabled&&!r.enabled)throw new Error("Transport created when disabled");e.call(this,a,"/xhr_streaming",t,r)}return s(o,e),o.enabled=function(a){return a.nullOrigin||i.isOpera()?!1:r.enabled},o.transportName="xhr-streaming",o.roundTrips=2,o.needBody=!!y.document,Te=o,Te}var xe,Ht;function at(){if(Ht)return xe;Ht=1;var s=L().EventEmitter,e=C(),t=W(),r=Q(),n=U(),i=function(){};function o(a,c,l){var u=this;s.call(this),setTimeout(function(){u._start(a,c,l)},0)}return e(o,s),o.prototype._start=function(a,c,l){var u=this,d=new y.XDomainRequest;c=n.addQuery(c,"t="+ +new Date),d.onerror=function(){u._error()},d.ontimeout=function(){u._error()},d.onprogress=function(){i("progress",d.responseText),u.emit("chunk",200,d.responseText)},d.onload=function(){u.emit("finish",200,d.responseText),u._cleanup(!1)},this.xdr=d,this.unloadRef=t.unloadAdd(function(){u._cleanup(!0)});try{this.xdr.open(a,c),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(l)}catch{this._error()}},o.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},o.prototype._cleanup=function(a){if(this.xdr){if(this.removeAllListeners(),t.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,a)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},o.prototype.close=function(){this._cleanup(!0)},o.enabled=!!(y.XDomainRequest&&r.hasDomain()),xe=o,xe}var Ce,Bt;function xr(){if(Bt)return Ce;Bt=1;var s=C(),e=$(),t=oe(),r=at();function n(i){if(!r.enabled)throw new Error("Transport created when disabled");e.call(this,i,"/xhr_streaming",t,r)}return s(n,e),n.enabled=function(i){return i.cookie_needed||i.nullOrigin?!1:r.enabled&&i.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,Ce=n,Ce}var Re,jt;function Cr(){return jt||(jt=1,Re=y.EventSource),Re}var Ie,Dt;function Qr(){if(Dt)return Ie;Dt=1;var s=C(),e=L().EventEmitter,t=Cr(),r=function(){};function n(i){e.call(this);var o=this,a=this.es=new t(i);a.onmessage=function(c){r("message",c.data),o.emit("message",decodeURI(c.data))},a.onerror=function(c){r("error",a.readyState);var l=a.readyState!==2?"network":"permanent";o._cleanup(),o._close(l)}}return s(n,e),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var i=this.es;i&&(i.onmessage=i.onerror=null,i.close(),this.es=null)},n.prototype._close=function(i){var o=this;setTimeout(function(){o.emit("close",null,i),o.removeAllListeners()},200)},Ie=n,Ie}var Oe,Pt;function Wt(){if(Pt)return Oe;Pt=1;var s=C(),e=$(),t=Qr(),r=ae(),n=Cr();function i(o){if(!i.enabled())throw new Error("Transport created when disabled");e.call(this,o,"/eventsource",t,r)}return s(i,e),i.enabled=function(){return!!n},i.transportName="eventsource",i.roundTrips=2,Oe=i,Oe}var Ne,Ft;function Rr(){return Ft||(Ft=1,Ne="1.6.1"),Ne}var Ae={exports:{}},Mt;function K(){return Mt||(Mt=1,(function(s){var e=W(),t=Q();s.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){s.exports.WPrefix in y||(y[s.exports.WPrefix]={})},postMessage:function(r,n){y.parent!==y&&y.parent.postMessage(JSON.stringify({windowId:s.exports.currentWindowId,type:r,data:n||""}),"*")},createIframe:function(r,n){var i=y.document.createElement("iframe"),o,a,c=function(){clearTimeout(o);try{i.onload=null}catch{}i.onerror=null},l=function(){i&&(c(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),e.unloadDel(a))},u=function(b){i&&(l(),n(b))},d=function(b,S){setTimeout(function(){try{i&&i.contentWindow&&i.contentWindow.postMessage(b,S)}catch{}},0)};return i.src=r,i.style.display="none",i.style.position="absolute",i.onerror=function(){u("onerror")},i.onload=function(){clearTimeout(o),o=setTimeout(function(){u("onload timeout")},2e3)},y.document.body.appendChild(i),o=setTimeout(function(){u("timeout")},15e3),a=e.unloadAdd(l),{post:d,cleanup:l,loaded:c}},createHtmlfile:function(r,n){var i=["Active"].concat("Object").join("X"),o=new y[i]("htmlfile"),a,c,l,u=function(){clearTimeout(a),l.onerror=null},d=function(){o&&(u(),e.unloadDel(c),l.parentNode.removeChild(l),l=o=null,CollectGarbage())},b=function(k){o&&(d(),n(k))},S=function(k,I){try{setTimeout(function(){l&&l.contentWindow&&l.contentWindow.postMessage(k,I)},0)}catch{}};o.open(),o.write('<html><script>document.domain="'+y.document.domain+'";<\/script></html>'),o.close(),o.parentWindow[s.exports.WPrefix]=y[s.exports.WPrefix];var R=o.createElement("div");return o.body.appendChild(R),l=o.createElement("iframe"),R.appendChild(l),l.src=r,l.onerror=function(){b("onerror")},a=setTimeout(function(){b("timeout")},15e3),c=e.unloadAdd(d),{post:S,cleanup:d,loaded:u}}},s.exports.iframeEnabled=!1,y.document&&(s.exports.iframeEnabled=(typeof y.postMessage=="function"||typeof y.postMessage=="object")&&!t.isKonqueror())})(Ae)),Ae.exports}var qe,Vt;function Ir(){if(Vt)return qe;Vt=1;var s=C(),e=L().EventEmitter,t=Rr(),r=U(),n=K(),i=W(),o=V(),a=function(){};function c(l,u,d){if(!c.enabled())throw new Error("Transport created when disabled");e.call(this);var b=this;this.origin=r.getOrigin(d),this.baseUrl=d,this.transUrl=u,this.transport=l,this.windowId=o.string(8);var S=r.addPath(d,"/iframe.html")+"#"+this.windowId;this.iframeObj=n.createIframe(S,function(R){b.emit("close",1006,"Unable to load an iframe ("+R+")"),b.close()}),this.onmessageCallback=this._message.bind(this),i.attachEvent("message",this.onmessageCallback)}return s(c,e),c.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){i.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},c.prototype._message=function(l){if(a("message",l.data),!r.isOriginEqual(l.origin,this.origin)){a("not same origin",l.origin,this.origin);return}var u;try{u=JSON.parse(l.data)}catch{a("bad json",l.data);return}if(u.windowId!==this.windowId){a("mismatched window id",u.windowId,this.windowId);return}switch(u.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([t,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",u.data);break;case"c":var d;try{d=JSON.parse(u.data)}catch{a("bad json",u.data);return}this.emit("close",d[0],d[1]),this.close();break}},c.prototype.postMessage=function(l,u){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:l,data:u||""}),this.origin)},c.prototype.send=function(l){this.postMessage("m",l)},c.enabled=function(){return n.iframeEnabled},c.transportName="iframe",c.roundTrips=2,qe=c,qe}var Le,$t;function ct(){return $t||($t=1,Le={isObject:function(s){var e=typeof s;return e==="function"||e==="object"&&!!s},extend:function(s){if(!this.isObject(s))return s;for(var e,t,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s}}),Le}var Ue,Xt;function He(){if(Xt)return Ue;Xt=1;var s=C(),e=Ir(),t=ct();return Ue=function(r){function n(i,o){e.call(this,r.transportName,i,o)}return s(n,e),n.enabled=function(i,o){if(!y.document)return!1;var a=t.extend({},o);return a.sameOrigin=!0,r.enabled(a)&&e.enabled()},n.transportName="iframe-"+r.transportName,n.needBody=!0,n.roundTrips=e.roundTrips+r.roundTrips-1,n.facadeTransport=r,n},Ue}var Be,Gt;function Kr(){if(Gt)return Be;Gt=1;var s=C(),e=K(),t=U(),r=L().EventEmitter,n=V(),i=function(){};function o(c){r.call(this);var l=this;e.polluteGlobalNamespace(),this.id="a"+n.string(6),c=t.addQuery(c,"c="+decodeURIComponent(e.WPrefix+"."+this.id)),i("using htmlfile",o.htmlfileEnabled);var u=o.htmlfileEnabled?e.createHtmlfile:e.createIframe;y[e.WPrefix][this.id]={start:function(){l.iframeObj.loaded()},message:function(d){l.emit("message",d)},stop:function(){l._cleanup(),l._close("network")}},this.iframeObj=u(c,function(){l._cleanup(),l._close("permanent")})}s(o,r),o.prototype.abort=function(){this._cleanup(),this._close("user")},o.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete y[e.WPrefix][this.id]},o.prototype._close=function(c){this.emit("close",null,c),this.removeAllListeners()},o.htmlfileEnabled=!1;var a=["Active"].concat("Object").join("X");if(a in y)try{o.htmlfileEnabled=!!new y[a]("htmlfile")}catch{}return o.enabled=o.htmlfileEnabled||e.iframeEnabled,Be=o,Be}var je,Jt;function zt(){if(Jt)return je;Jt=1;var s=C(),e=Kr(),t=z(),r=$();function n(i){if(!e.enabled)throw new Error("Transport created when disabled");r.call(this,i,"/htmlfile",e,t)}return s(n,r),n.enabled=function(i){return e.enabled&&i.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,je=n,je}var De,Qt;function Kt(){if(Qt)return De;Qt=1;var s=C(),e=$(),t=oe(),r=ae(),n=z();function i(o){if(!n.enabled&&!r.enabled)throw new Error("Transport created when disabled");e.call(this,o,"/xhr",t,r)}return s(i,e),i.enabled=function(o){return o.nullOrigin?!1:n.enabled&&o.sameOrigin?!0:r.enabled},i.transportName="xhr-polling",i.roundTrips=2,De=i,De}var Pe,Zt;function Zr(){if(Zt)return Pe;Zt=1;var s=C(),e=$(),t=xr(),r=oe(),n=at();function i(o){if(!n.enabled)throw new Error("Transport created when disabled");e.call(this,o,"/xhr",r,n)}return s(i,e),i.enabled=t.enabled,i.transportName="xdr-polling",i.roundTrips=2,Pe=i,Pe}var We,Yt;function Yr(){if(Yt)return We;Yt=1;var s=K(),e=V(),t=Q(),r=U(),n=C(),i=L().EventEmitter,o=function(){};function a(c){var l=this;i.call(this),s.polluteGlobalNamespace(),this.id="a"+e.string(6);var u=r.addQuery(c,"c="+encodeURIComponent(s.WPrefix+"."+this.id));y[s.WPrefix][this.id]=this._callback.bind(this),this._createScript(u),this.timeoutId=setTimeout(function(){l._abort(new Error("JSONP script loaded abnormally (timeout)"))},a.timeout)}return n(a,i),a.prototype.abort=function(){if(y[s.WPrefix][this.id]){var c=new Error("JSONP user aborted read");c.code=1e3,this._abort(c)}},a.timeout=35e3,a.scriptErrorTimeout=1e3,a.prototype._callback=function(c){this._cleanup(),!this.aborting&&(c&&this.emit("message",c),this.emit("close",null,"network"),this.removeAllListeners())},a.prototype._abort=function(c){this._cleanup(),this.aborting=!0,this.emit("close",c.code,c.message),this.removeAllListeners()},a.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var c=this.script;c.parentNode.removeChild(c),c.onreadystatechange=c.onerror=c.onload=c.onclick=null,this.script=null}delete y[s.WPrefix][this.id]},a.prototype._scriptError=function(){var c=this;this.errorTimer||(this.errorTimer=setTimeout(function(){c.loadedOkay||c._abort(new Error("JSONP script loaded abnormally (onerror)"))},a.scriptErrorTimeout))},a.prototype._createScript=function(c){var l=this,u=this.script=y.document.createElement("script"),d;if(u.id="a"+e.string(8),u.src=c,u.type="text/javascript",u.charset="UTF-8",u.onerror=this._scriptError.bind(this),u.onload=function(){l._abort(new Error("JSONP script loaded abnormally (onload)"))},u.onreadystatechange=function(){if(o("onreadystatechange",u.readyState),/loaded|closed/.test(u.readyState)){if(u&&u.htmlFor&&u.onclick){l.loadedOkay=!0;try{u.onclick()}catch{}}u&&l._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof u.async>"u"&&y.document.attachEvent)if(t.isOpera())d=this.script2=y.document.createElement("script"),d.text="try{var a = document.getElementById('"+u.id+"'); if(a)a.onerror();}catch(x){};",u.async=d.async=!1;else{try{u.htmlFor=u.id,u.event="onclick"}catch{}u.async=!0}typeof u.async<"u"&&(u.async=!0);var b=y.document.getElementsByTagName("head")[0];b.insertBefore(u,b.firstChild),d&&b.insertBefore(d,b.firstChild)},We=a,We}var Fe,er;function en(){if(er)return Fe;er=1;var s=V(),e=U(),t=function(){},r,n;function i(a){try{return y.document.createElement('<iframe name="'+a+'">')}catch{var c=y.document.createElement("iframe");return c.name=a,c}}function o(){r=y.document.createElement("form"),r.style.display="none",r.style.position="absolute",r.method="POST",r.enctype="application/x-www-form-urlencoded",r.acceptCharset="UTF-8",n=y.document.createElement("textarea"),n.name="d",r.appendChild(n),y.document.body.appendChild(r)}return Fe=function(a,c,l){r||o();var u="a"+s.string(8);r.target=u,r.action=e.addQuery(e.addPath(a,"/jsonp_send"),"i="+u);var d=i(u);d.id=u,d.style.display="none",r.appendChild(d);try{n.value=c}catch{}r.submit();var b=function(S){d.onerror&&(d.onreadystatechange=d.onerror=d.onload=null,setTimeout(function(){d.parentNode.removeChild(d),d=null},500),n.value="",l(S))};return d.onerror=function(){b()},d.onload=function(){b()},d.onreadystatechange=function(S){t("onreadystatechange",u,d.readyState),d.readyState==="complete"&&b()},function(){b(new Error("Aborted"))}},Fe}var Me,tr;function tn(){if(tr)return Me;tr=1;var s=C(),e=kr(),t=Yr(),r=en();function n(i){if(!n.enabled())throw new Error("Transport created when disabled");e.call(this,i,"/jsonp",r,t)}return s(n,e),n.enabled=function(){return!!y.document},n.transportName="jsonp-polling",n.roundTrips=1,n.needBody=!0,Me=n,Me}var Ve,rr;function rn(){return rr||(rr=1,Ve=[Xr(),zr(),xr(),Wt(),He()(Wt()),zt(),He()(zt()),Kt(),Zr(),He()(Kt()),tn()]),Ve}var nr={},ir;function nn(){if(ir)return nr;ir=1;var s=Array.prototype,e=Object.prototype,t=Function.prototype,r=String.prototype,n=s.slice,i=e.toString,o=function(g){return e.toString.call(g)==="[object Function]"},a=function(f){return i.call(f)==="[object Array]"},c=function(f){return i.call(f)==="[object String]"},l=Object.defineProperty&&(function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}})(),u;l?u=function(g,f,_,T){!T&&f in g||Object.defineProperty(g,f,{configurable:!0,enumerable:!1,writable:!0,value:_})}:u=function(g,f,_,T){!T&&f in g||(g[f]=_)};var d=function(g,f,_){for(var T in f)e.hasOwnProperty.call(f,T)&&u(g,T,f[T],_)},b=function(g){if(g==null)throw new TypeError("can't convert "+g+" to object");return Object(g)};function S(g){var f=+g;return f!==f?f=0:f!==0&&f!==1/0&&f!==-1/0&&(f=(f>0||-1)*Math.floor(Math.abs(f))),f}function R(g){return g>>>0}function k(){}d(t,{bind:function(f){var _=this;if(!o(_))throw new TypeError("Function.prototype.bind called on incompatible "+_);for(var T=n.call(arguments,1),x=function(){if(this instanceof A){var F=_.apply(this,T.concat(n.call(arguments)));return Object(F)===F?F:this}else return _.apply(f,T.concat(n.call(arguments)))},N=Math.max(0,_.length-T.length),w=[],B=0;B<N;B++)w.push("$"+B);var A=Function("binder","return function ("+w.join(",")+"){ return binder.apply(this, arguments); }")(x);return _.prototype&&(k.prototype=_.prototype,A.prototype=new k,k.prototype=null),A}}),d(Array,{isArray:a});var I=Object("a"),O=I[0]!=="a"||!(0 in I),p=function(f){var _=!0,T=!0;return f&&(f.call("foo",function(x,N,w){typeof w!="object"&&(_=!1)}),f.call([1],function(){T=typeof this=="string"},"x")),!!f&&_&&T};d(s,{forEach:function(f){var _=b(this),T=O&&c(this)?this.split(""):_,x=arguments[1],N=-1,w=T.length>>>0;if(!o(f))throw new TypeError;for(;++N<w;)N in T&&f.call(x,T[N],N,_)}},!p(s.forEach));var m=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;d(s,{indexOf:function(f){var _=O&&c(this)?this.split(""):b(this),T=_.length>>>0;if(!T)return-1;var x=0;for(arguments.length>1&&(x=S(arguments[1])),x=x>=0?x:Math.max(0,T+x);x<T;x++)if(x in _&&_[x]===f)return x;return-1}},m);var h=r.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?(function(){var g=/()??/.exec("")[1]===void 0;r.split=function(f,_){var T=this;if(f===void 0&&_===0)return[];if(i.call(f)!=="[object RegExp]")return h.call(this,f,_);var x=[],N=(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.extended?"x":"")+(f.sticky?"y":""),w=0,B,A,F,ht;for(f=new RegExp(f.source,N+"g"),T+="",g||(B=new RegExp("^"+f.source+"$(?!\\s)",N)),_=_===void 0?-1>>>0:R(_);(A=f.exec(T))&&(F=A.index+A[0].length,!(F>w&&(x.push(T.slice(w,A.index)),!g&&A.length>1&&A[0].replace(B,function(){for(var Z=1;Z<arguments.length-2;Z++)arguments[Z]===void 0&&(A[Z]=void 0)}),A.length>1&&A.index<T.length&&s.push.apply(x,A.slice(1)),ht=A[0].length,w=F,x.length>=_)));)f.lastIndex===A.index&&f.lastIndex++;return w===T.length?(ht||!f.test(""))&&x.push(""):x.push(T.slice(w)),x.length>_?x.slice(0,_):x}})():"0".split(void 0,0).length&&(r.split=function(f,_){return f===void 0&&_===0?[]:h.call(this,f,_)});var v=r.substr,E="".substr&&"0b".substr(-1)!=="b";return d(r,{substr:function(f,_){return v.call(this,f<0&&(f=this.length+f)<0?0:f,_)}},E),nr}var $e,sr;function sn(){if(sr)return $e;sr=1;var s=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,e,t=function(r){var n,i={},o=[];for(n=0;n<65536;n++)o.push(String.fromCharCode(n));return r.lastIndex=0,o.join("").replace(r,function(a){return i[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),r.lastIndex=0,i};return $e={quote:function(r){var n=JSON.stringify(r);return s.lastIndex=0,s.test(n)?(e||(e=t(s)),n.replace(s,function(i){return e[i]})):n}},$e}var Xe,or;function on(){if(or)return Xe;or=1;var s=function(){};return Xe=function(e){return{filterToEnabled:function(t,r){var n={main:[],facade:[]};return t?typeof t=="string"&&(t=[t]):t=[],e.forEach(function(i){if(i&&!(i.transportName==="websocket"&&r.websocket===!1)){if(t.length&&t.indexOf(i.transportName)===-1){s("not in whitelist",i.transportName);return}i.enabled(r)?(s("enabled",i.transportName),n.main.push(i),i.facadeTransport&&n.facade.push(i.facadeTransport)):s("disabled",i.transportName)}}),n}}},Xe}var Ge,ar;function an(){if(ar)return Ge;ar=1;var s={};return["log","debug","warn"].forEach(function(e){var t;try{t=y.console&&y.console[e]&&y.console[e].apply}catch{}s[e]=t?function(){return y.console[e].apply(y.console,arguments)}:e==="log"?function(){}:s.log}),Ge=s,Ge}var Je,cr;function ut(){if(cr)return Je;cr=1;function s(e){this.type=e}return s.prototype.initEvent=function(e,t,r){return this.type=e,this.bubbles=t,this.cancelable=r,this.timeStamp=+new Date,this},s.prototype.stopPropagation=function(){},s.prototype.preventDefault=function(){},s.CAPTURING_PHASE=1,s.AT_TARGET=2,s.BUBBLING_PHASE=3,Je=s,Je}var ze,ur;function Or(){return ur||(ur=1,ze=y.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),ze}var Qe,hr;function cn(){if(hr)return Qe;hr=1;var s=C(),e=ut();function t(){e.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return s(t,e),Qe=t,Qe}var Ke,lr;function un(){if(lr)return Ke;lr=1;var s=C(),e=ut();function t(r){e.call(this),this.initEvent("message",!1,!1),this.data=r}return s(t,e),Ke=t,Ke}var Ze,fr;function hn(){if(fr)return Ze;fr=1;var s=L().EventEmitter,e=C();function t(){var r=this;s.call(this),this.to=setTimeout(function(){r.emit("finish",200,"{}")},t.timeout)}return e(t,s),t.prototype.close=function(){clearTimeout(this.to)},t.timeout=2e3,Ze=t,Ze}var Ye,dr;function Nr(){if(dr)return Ye;dr=1;var s=L().EventEmitter,e=C(),t=ct();function r(n,i){s.call(this);var o=this,a=+new Date;this.xo=new i("GET",n),this.xo.once("finish",function(c,l){var u,d;if(c===200){if(d=+new Date-a,l)try{u=JSON.parse(l)}catch{}t.isObject(u)||(u={})}o.emit("finish",u,d),o.removeAllListeners()})}return e(r,s),r.prototype.close=function(){this.removeAllListeners(),this.xo.close()},Ye=r,Ye}var et,pr;function Ar(){if(pr)return et;pr=1;var s=C(),e=L().EventEmitter,t=z(),r=Nr();function n(i){var o=this;e.call(this),this.ir=new r(i,t),this.ir.once("finish",function(a,c){o.ir=null,o.emit("message",JSON.stringify([a,c]))})}return s(n,e),n.transportName="iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},et=n,et}var tt,mr;function ln(){if(mr)return tt;mr=1;var s=L().EventEmitter,e=C(),t=W(),r=Ir(),n=Ar();function i(o,a){var c=this;s.call(this);var l=function(){var u=c.ifr=new r(n.transportName,a,o);u.once("message",function(d){if(d){var b;try{b=JSON.parse(d)}catch{c.emit("finish"),c.close();return}var S=b[0],R=b[1];c.emit("finish",S,R)}c.close()}),u.once("close",function(){c.emit("finish"),c.close()})};y.document.body?l():t.attachEvent("load",l)}return e(i,s),i.enabled=function(){return r.enabled()},i.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},tt=i,tt}var rt,vr;function fn(){if(vr)return rt;vr=1;var s=L().EventEmitter,e=C(),t=U(),r=at(),n=ae(),i=z(),o=hn(),a=ln(),c=Nr();function l(u,d){var b=this;s.call(this),setTimeout(function(){b.doXhr(u,d)},0)}return e(l,s),l._getReceiver=function(u,d,b){return b.sameOrigin?new c(d,i):n.enabled?new c(d,n):r.enabled&&b.sameScheme?new c(d,r):a.enabled()?new a(u,d):new c(d,o)},l.prototype.doXhr=function(u,d){var b=this,S=t.addPath(u,"/info");this.xo=l._getReceiver(u,S,d),this.timeoutRef=setTimeout(function(){b._cleanup(!1),b.emit("finish")},l.timeout),this.xo.once("finish",function(R,k){b._cleanup(!0),b.emit("finish",R,k)})},l.prototype._cleanup=function(u){clearTimeout(this.timeoutRef),this.timeoutRef=null,!u&&this.xo&&this.xo.close(),this.xo=null},l.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},l.timeout=8e3,rt=l,rt}var nt,br;function dn(){if(br)return nt;br=1;var s=K();function e(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}return e.prototype._transportClose=function(t,r){s.postMessage("c",JSON.stringify([t,r]))},e.prototype._transportMessage=function(t){s.postMessage("t",t)},e.prototype._send=function(t){this._transport.send(t)},e.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},nt=e,nt}var it,gr;function pn(){if(gr)return it;gr=1;var s=U(),e=W(),t=dn(),r=Ar(),n=K(),i=Or(),o=function(){};return it=function(a,c){var l={};c.forEach(function(d){d.facadeTransport&&(l[d.facadeTransport.transportName]=d.facadeTransport)}),l[r.transportName]=r;var u;a.bootstrap_iframe=function(){var d;n.currentWindowId=i.hash.slice(1);var b=function(S){if(S.source===parent&&(typeof u>"u"&&(u=S.origin),S.origin===u)){var R;try{R=JSON.parse(S.data)}catch{o("bad json",S.data);return}if(R.windowId===n.currentWindowId)switch(R.type){case"s":var k;try{k=JSON.parse(R.data)}catch{o("bad json",R.data);break}var I=k[0],O=k[1],p=k[2],m=k[3];if(I!==a.version)throw new Error('Incompatible SockJS! Main site uses: "'+I+'", the iframe: "'+a.version+'".');if(!s.isOriginEqual(p,i.href)||!s.isOriginEqual(m,i.href))throw new Error("Can't connect to different domain from within an iframe. ("+i.href+", "+p+", "+m+")");d=new t(new l[O](p,m));break;case"m":d._send(R.data);break;case"c":d&&d._close(),d=null;break}}};e.attachEvent("message",b),n.postMessage("s")}},it}var st,yr;function mn(){if(yr)return st;yr=1,nn();var s=Er(),e=C(),t=V(),r=sn(),n=U(),i=W(),o=on(),a=ct(),c=Q(),l=an(),u=ut(),d=Sr(),b=Or(),S=cn(),R=un(),k=fn(),I=function(){},O;function p(h,v,E){if(!(this instanceof p))return new p(h,v,E);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");d.call(this),this.readyState=p.CONNECTING,this.extensions="",this.protocol="",E=E||{},E.protocols_whitelist&&l.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=E.transports,this._transportOptions=E.transportOptions||{},this._timeout=E.timeout||0;var g=E.sessionId||8;if(typeof g=="function")this._generateSessionId=g;else if(typeof g=="number")this._generateSessionId=function(){return t.string(g)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=E.server||t.numberString(1e3);var f=new s(h);if(!f.host||!f.protocol)throw new SyntaxError("The URL '"+h+"' is invalid");if(f.hash)throw new SyntaxError("The URL must not contain a fragment");if(f.protocol!=="http:"&&f.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+f.protocol+"' is not allowed.");var _=f.protocol==="https:";if(b.protocol==="https:"&&!_&&!n.isLoopbackAddr(f.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");v?Array.isArray(v)||(v=[v]):v=[];var T=v.sort();T.forEach(function(N,w){if(!N)throw new SyntaxError("The protocols entry '"+N+"' is invalid.");if(w<T.length-1&&N===T[w+1])throw new SyntaxError("The protocols entry '"+N+"' is duplicated.")});var x=n.getOrigin(b.href);this._origin=x?x.toLowerCase():null,f.set("pathname",f.pathname.replace(/\/+$/,"")),this.url=f.href,I("using url",this.url),this._urlInfo={nullOrigin:!c.hasDomain(),sameOrigin:n.isOriginEqual(this.url,b.href),sameScheme:n.isSchemeEqual(this.url,b.href)},this._ir=new k(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}e(p,d);function m(h){return h===1e3||h>=3e3&&h<=4999}return p.prototype.close=function(h,v){if(h&&!m(h))throw new Error("InvalidAccessError: Invalid code");if(v&&v.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===p.CLOSING||this.readyState===p.CLOSED)){var E=!0;this._close(h||1e3,v||"Normal closure",E)}},p.prototype.send=function(h){if(typeof h!="string"&&(h=""+h),this.readyState===p.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===p.OPEN&&this._transport.send(r.quote(h))},p.version=Rr(),p.CONNECTING=0,p.OPEN=1,p.CLOSING=2,p.CLOSED=3,p.prototype._receiveInfo=function(h,v){if(this._ir=null,!h){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(v),this._transUrl=h.base_url?h.base_url:this.url,h=a.extend(h,this._urlInfo);var E=O.filterToEnabled(this._transportsWhitelist,h);this._transports=E.main,I(this._transports.length+" enabled transports"),this._connect()},p.prototype._connect=function(){for(var h=this._transports.shift();h;h=this._transports.shift()){if(I("attempt",h.transportName),h.needBody&&(!y.document.body||typeof y.document.readyState<"u"&&y.document.readyState!=="complete"&&y.document.readyState!=="interactive")){this._transports.unshift(h),i.attachEvent("load",this._connect.bind(this));return}var v=Math.max(this._timeout,this._rto*h.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),v);var E=n.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),g=this._transportOptions[h.transportName],f=new h(E,this._transUrl,g);f.on("message",this._transportMessage.bind(this)),f.once("close",this._transportClose.bind(this)),f.transportName=h.transportName,this._transport=f;return}this._close(2e3,"All transports failed",!1)},p.prototype._transportTimeout=function(){this.readyState===p.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},p.prototype._transportMessage=function(h){var v=this,E=h.slice(0,1),g=h.slice(1),f;switch(E){case"o":this._open();return;case"h":this.dispatchEvent(new u("heartbeat")),I("heartbeat",this.transport);return}if(g)try{f=JSON.parse(g)}catch{}if(!(typeof f>"u"))switch(E){case"a":Array.isArray(f)&&f.forEach(function(_){I("message",v.transport),v.dispatchEvent(new R(_))});break;case"m":I("message",this.transport),this.dispatchEvent(new R(f));break;case"c":Array.isArray(f)&&f.length===2&&this._close(f[0],f[1],!0);break}},p.prototype._transportClose=function(h,v){if(I("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!m(h)&&h!==2e3&&this.readyState===p.CONNECTING){this._connect();return}this._close(h,v)},p.prototype._open=function(){I("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===p.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=p.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new u("open")),I("connected",this.transport)):this._close(1006,"Server lost session")},p.prototype._close=function(h,v,E){I("_close",this.transport,h,v,E,this.readyState);var g=!1;if(this._ir&&(g=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===p.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=p.CLOSING,setTimeout((function(){this.readyState=p.CLOSED,g&&this.dispatchEvent(new u("error"));var f=new S("close");f.wasClean=E||!1,f.code=h||1e3,f.reason=v,this.dispatchEvent(f),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},p.prototype.countRTO=function(h){return h>100?4*h:300+h},st=function(h){return O=o(h),pn()(p,h),p},st}var ot,_r;function vn(){if(_r)return ot;_r=1;var s=rn();return ot=mn()(s),"_sockjs_onload"in y&&setTimeout(y._sockjs_onload,1),ot}var bn=vn();const gn=qr(bn),yn="/ws";class _n{client;connected=!1;constructor(){this.client=new Wr({webSocketFactory:()=>new gn(yn),reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.client.onConnect=()=>{this.connected=!0,console.log(" Connected to WebSocket")},this.client.onDisconnect=()=>{this.connected=!1,console.log(" Disconnected from WebSocket")},this.client.onStompError=e=>{console.error("Broker reported error: "+e.headers.message),console.error("Additional details: "+e.body)}}connect(e){if(this.client.active&&this.connected){e&&e();return}if(e){const t=this.client.onConnect;this.client.onConnect=r=>{t(r),e()}}this.client.activate()}disconnect(){this.client.active&&(this.client.deactivate(),this.connected=!1)}subscribe(e,t){if(!this.client.active||!this.connected){console.warn("Socket not connected. Connecting first..."),this.connect(()=>{this.doSubscribe(e,t)});return}return this.doSubscribe(e,t)}doSubscribe(e,t){return console.log(`Subscribing to ${e}...`),this.client.subscribe(e,r=>{try{if(r.body){const n=JSON.parse(r.body);t(n)}}catch(n){console.error("Error parsing socket message",n)}})}}const X=new _n,wr={getTableInfo:async s=>lt.get(ft.TABLES.INFO(s)),requestOpenTable:async s=>lt.post(ft.TABLES.REQUEST_OPEN(s))};function En({children:s}){const[e,t]=j.useState(()=>{const m=localStorage.getItem("current-table-id");return m?parseInt(m):null}),[r,n]=j.useState(null),[i,o]=j.useState(!1),[a,c]=j.useState(()=>!!localStorage.getItem("table-session-token")),[l,u]=j.useState(null),[d,b]=j.useState(0),[S,R]=j.useState(0),k=j.useCallback(m=>{switch(console.log(" Socket received:",m),m.type){case"TABLE_OPENED":m.token&&(localStorage.setItem("table-session-token",m.token),o(!1),c(!0),M.success("Bn  c m! Chc qu khch ngon ming."));break;case"TABLE_CHANGED":if(m.newTableId&&m.newTableToken){localStorage.setItem("current-table-id",m.newTableId.toString()),localStorage.setItem("table-session-token",m.newTableToken),t(m.newTableId),n(m.newTableName||`Bn ${m.newTableId}`);const h=`/table/${m.newTableId}`;window.history.replaceState(null,"",h),M.info(`Bn  c chuyn sang ${m.newTableName}`,{duration:5e3,icon:""})}break;case"PAYMENT_CONFIRMED":m.qrCodeUrl&&(u(m.qrCodeUrl),M.success("Nhn vin  xc nhn. Vui lng qut m  thanh ton.",{duration:5e3}));break;case"ORDER_UPDATE":b(Date.now());break;case"TRANSFER_SUCCESS":localStorage.removeItem("table-session-token"),localStorage.removeItem("customer-cart"),localStorage.removeItem("current_order_id"),c(!1),u(null),o(!1),b(0),M.success("Thanh ton thnh cng! Cm n qu khch v hn gp li.",{duration:5e3,icon:""});break;case"MENU_STATUS_CHANGED":R(Date.now());break;default:m&&typeof m=="object"&&"id"in m&&"status"in m&&b(Date.now());break}},[]);j.useEffect(()=>{if(e){const m=`/topic/table/${e}`,h="/topic/menus";X.disconnect(),X.connect(()=>{X.subscribe(m,k),X.subscribe(h,k)})}return()=>{e&&X.disconnect()}},[e,k]);const I=j.useCallback(async m=>{t(m),localStorage.setItem("current-table-id",m.toString());try{const h=await wr.getTableInfo(m);n(h.name)}catch(h){console.warn("Failed to fetch table info:",h)}},[]),O=async m=>{o(!0);try{await wr.requestOpenTable(m),M.info(" gi yu cu. Vui lng i nhn vin...")}catch(h){o(!1),console.error(h),M.error("Li kt ni.")}},p=()=>u(null);return Lr.jsx(Ur.Provider,{value:{tableId:e,tableName:r,isWaitingForStaff:i,isTableOpened:a,paymentQrCode:l,lastOrderUpdate:d,lastMenuUpdate:S,requestOpenTable:O,joinTable:I,clearPaymentState:p},children:s})}export{En as TableProvider};
